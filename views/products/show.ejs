<!DOCTYPE html>
<html lang="en">

<head>
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
  <script>
    var bookedDates = <%- JSON.stringify(bookedDates) %>
  </script>
  <script src="\js\bookingLogic.js"></script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    <%= product.name %> Detail
  </title>
  <style>
    /* CSS for map container */
    #map {
      height: 400px;
      width: 100%;
    }
  </style>
</head>

<body>
  <h1>
    <%= product.name %> Detail
  </h1>
  <p>User: <a href="../users/show/<%= product.userId._id %>"><%= product.userId.username %></a></p>

  <p>Description: <%= product.description %>
  </p>
  <p>Price: <%= product.price %>
  </p>
  <p>Images:</p>
  <ul>
    <% product.images.forEach(image=> { %>
      <li><img src="<%= image %>" alt="Product Image"></li>
      <% }); %>
  </ul>
  <p>Location:</p>

  <!-- Map container -->
  <div id="map"></div>

  <script>  //this only needs to ever be this short to show one pin so ig it can stay here
    // JavaScript to initialize Google Map
    function initMap() {
      // Product coordinates
      var productCoordinates = <%- JSON.stringify(product.location.coordinates) %>;

      // Create a map centered at the product coordinates
      var map = new google.maps.Map(document.getElementById("map"), {
        zoom: 12, // Adjust zoom level as needed
        center: { lat: productCoordinates[1], lng: productCoordinates[0] } // Coordinates in [longitude, latitude] format
      });

      // Create a marker at the product location
      var marker = new google.maps.Marker({
        position: { lat: productCoordinates[1], lng: productCoordinates[0] },
        map: map,
        title: "<%= product.name %> Location" // Optional: Tooltip text for marker
      });
    }
  </script>

  <!-- Call the initMap function after Google Maps API is loaded -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAxJvrodMZmejSbwGnMpnrICC36ZSGlqW8&callback=initMap"></script>
</body>



<% if (product.location.address) { %>
  <p>Address: <%= product.location.address %>
  </p>
  <% } %>
    <% if (product.location.addressDesc) { %>
      <p>Address Description: <%= product.location.addressDesc %>
      </p>
      <% } %>

        <div id='calendar'></div>
        <h2>Book this Product</h2>
        <form id="bookingForm" action="/products/<%= product._id %>/bookings" method="POST">
          <input type="hidden" id="startDate" name="startDate" value="">
          <input type="hidden" id="endDate" name="endDate" value="">
          <!-- Additional input fields for booking details -->
          <!-- For example, input fields for the user's name and email -->
          <label for="bookedBy">Booked By:</label>
          <input type="hidden" id="bookedBy" name="bookedBy" value=<%=userId%> required>
          <button type="submit">Book Now</button>
        </form>



        <h2>Reviews</h2>
  <ul>
    <% reviews.forEach(review => { %>
      <li>
        <p>Rating: <%= review.rating %>/5</p>
        <p>Review: <%= review.text %></p>
        <p>Reviewed By: <%= review.reviewer.username %></p>
      </li>
    <% }); %>
  </ul>

  <!-- Form for Leaving a Review -->
  <h2>Leave a Review</h2>
  <form id="reviewForm" action="/products/<%= product._id %>/reviews" method="POST">
    <label for="rating">Rating (out of 5):</label>
    <input type="number" id="rating" name="rating" min="1" max="5" required>
    <br>
    <label for="text">Review:</label>
    <textarea id="text" name="text" required></textarea>
    <br>
    <!-- Additional input fields for review details -->
    <!-- For example, input fields for the reviewer's name and email -->
    <input type="hidden" id="reviewer" name="reviewer" value="<%= userId %>" required>
    <button type="submit">Submit Review</button>
  </form>
        </body>

</html>